<!DOCTYPE html>
<html>
<head>
    <script src="src/snake.js" type="text/javascript"></script>
    <script src="draw.js" type="text/javascript"></script>

    <script src="https://cdn.socket.io/socket.io-1.3.0.js"></script>
    
    <script type="text/javascript">
    var game = null, FPS = 60, TURN_TIME = 75,
        update_clock = null, draw_clock = null;

    window.requestAnimFrame = (function(){
        return  window.requestAnimationFrame       ||
                window.webkitRequestAnimationFrame ||
                window.mozRequestAnimationFrame    ||
                window.oRequestAnimationFrame      ||
                window.msRequestAnimationFrame     ||
                function( callback ){
                    window.setTimeout(callback, 1000 / FPS);
                };
    })();
    window.cancelRequestAnimFrame = ( function() {
        return window.cancelAnimationFrame                 ||
               window.webkitCancelRequestAnimationFrame    ||
               window.mozCancelRequestAnimationFrame       ||
               window.oCancelRequestAnimationFrame         ||
               window.msCancelRequestAnimationFrame        ||
               clearTimeout
    } )();

    function animation () {
        draw_clock = requestAnimationFrame(animation);
        game.draw();
    }
    
    function init () {
        game = new DrawSystem('draw-field', new Coord(50, 50));
        animation();

        var socket = io.connect('http://localhost:8090/');

        socket.on('update', function (data) {
            game.board.from_json(data.game);
        });

        window.onkeydown = function(e) {
            e = e || window.event;
            // 37 is left arrow
            var dir = e.keyCode - 37;
            if (dir >= 0 && dir < 4) {
                socket.emit('input', dir);
            }
        }

    }

    </script>
</head>
<body onload="javascript:init()">
    <canvas id="draw-field" style="border: 1px solid black;"></canvas>       
</body>
</html>